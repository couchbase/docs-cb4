<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic xml:lang="en-us" id="topic2659">
	<title>Network Configuration</title>
	<shortdesc>Couchbase Server uses specific network ports for communication between server components
		and with the clients accessing the data stored in the Couchbase Server cluster.</shortdesc>
	<body>
		<p>The ports listed in the following table must be open on the host for Couchbase Server to operate correctly. 
			Couchbase Server configures these ports automatically, but you must verify that any 
			firewall configuration allows communication on the specified ports for each usage type. 
			If this is not done, the node can experience difficulty in joining a cluster, 
			including acting as a cluster of one node rather than joining the intended cluster.</p>


		<p>The following table lists the ports used for different types of Couchbase Server network communication:</p>
		<dl>
			<dlentry>
				<dt>Node-to-node</dt>
				<dd>Couchbase Server uses these ports for communication between all nodes within the cluster.
					These ports must be open to enable nodes to communicate with each other.</dd>
				<dd>For communication between all nodes within the cluster, you won't necessarily be using a firewall, but these are the ports used:</dd>
				<dd>4369, 8091, 8092, 8093, 8094 (Couchbase Server 4.5 and upwards), 9100, 9101, 9102, 9103, 9104, 9105, 9999, 11209, 11210, 18093, 21100-21299 (inclusive).</dd>
			</dlentry>
		
			<dlentry>
				<dt>Node-to-client</dt>
				<dd>These ports should be open between each node within the cluster and any 
					client nodes accessing data within the cluster.</dd>
				<dd>8091, 8092, 8093, 8094 (Couchbase Server 4.5 and upwards), 11207, 11210, 11211, 18091, 18092, 18093.</dd>
			</dlentry>
		</dl>
		<dl>
			<dlentry>
				<dt>Cluster administration</dt>
				<dd>Couchbase Server uses these ports for administration via the REST API, command-line clients, and web browsers.</dd>
				<dd>8091, 8094 (Couchbase Server 4.5 and upwards), 9102, 9998, 18091.</dd>
			</dlentry>
			<dlentry>
				<dt>XDCR</dt>
				<dd>These ports are used for XDCR (Cross Datacenter Replication) communication between all nodes
					in both the source and destination clusters.</dd>
				<dd><b>XDCR v1 (CAPI)</b></dd>
				<dd>8091, 8092, 8093, 9998, 18093.</dd>
				<dd><b>XDCR v2 (XMEM)</b></dd>
				<dd>8091, 8092, 8093, 9998, 11207 (when SSL used), 11210, 11214, 11215, 18091, 18092, 18093.</dd>
			</dlentry>
		</dl>
		
		
		
		<table>
				<tgroup cols="8">
				<colspec colname="col1" colwidth="1*"/>
				<colspec colname="col2" colwidth="1*"/>
				<colspec colname="col3" colwidth="3*"/>
				<colspec colname="col4" colwidth="1*"/>
				<colspec colname="col5" colwidth="1*"/>
				<colspec colname="col6" colwidth="1*"/>
				<colspec colname="col7" colwidth="1*"/>
				<colspec colname="col8" colwidth="1*"/>
				<thead>
					<row>
						<entry>Port</entry>
						<entry>Port Name</entry>
						<entry>Description</entry>
						<entry>Node-to-node</entry>
						<entry>Node-to-client*</entry>
						<entry>Cluster administration</entry>
						<entry>XDCR v1 (CAPI)</entry>
						<entry>XDCR v2 (XMEM)</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>8091</entry>
						<entry>rest_port</entry>
						<entry>Used by the Couchbase Web Console for REST/HTTP traffic.</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
					</row>
					<row>
						<entry>8092</entry>
						<entry>capi_port</entry>
						<entry>Used to access views, run queries, XDCR and update design documents.</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
					</row>
					
					<row>
						<entry>8093</entry>
						<entry>query_port</entry>
						<entry>Used by query services for REST/HTTP traffic.</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
					</row>
					<row>
						<entry>8094**</entry>
						<entry>fts_http_port</entry>
						<entry>External HTTP port for the Search service</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					
					
					<row>
						<entry>9100</entry>
						<entry>indexer_admin_port</entry>
						<entry>Internal index admin port (-adminPort).</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					<row>
						<entry>9101</entry>
						<entry>indexer_scan_port</entry>
						<entry>Internal index scan port (-scanPort).</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					<row>
						<entry>9102</entry>
						<entry>indexer_http_port</entry>
						<entry>Internal index HTTP port (-httpPort).</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					<row>
						<entry>9103</entry>
						<entry>indexer_stinit_port</entry>
						<entry>Internal index build port (-streamInitPort).</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					<row>
						<entry>9104</entry>
						<entry>indexer_stcatchup_port</entry>
						<entry>Internal index build port (-streamCatchupPort ).</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					<row>
						<entry>9105</entry>
						<entry>indexer_stmaint_port</entry>
						<entry>Internal index maintenance port (-streamMaintPort).</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					<row>
						<entry>9998</entry>
						<entry>xdcr_rest_port</entry>
						<entry>Internal REST port.</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
					</row>
					<row>
						<entry>9999</entry>
						<entry>projector_port</entry>
						<entry>Internal GSI port used by the internal administrators.</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
				
					<row>
						<entry>11207***</entry>
						<entry>memcached_ssl_port</entry>
						<entry>Used by smart client libraries to access data nodes using SSL. This is a memcached SSL
							port.</entry>
						<entry>No</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>Yes when SSL is used</entry>
					</row>
					<row>
						<entry>11209</entry>
						<entry>memcached_dedicated_port</entry>
						<entry>Internal Bucket Port.</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					<row>
						<entry>11210***</entry>
						<entry>memcached_port</entry>
						<entry>Used by smart client libraries or Moxi to directly connect to the data nodes. The XDCR
							client uses this port as well as the SDKs. This is a memcached
							port.</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>Yes</entry>
					</row>
					<row>
						<entry>11211</entry>
						<entry>moxi_port</entry>
						<entry>Used by pre-existing Couchbase Server and memcached (non-smart) client libraries (such
							as Moxi).</entry>
						<entry>No</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					<row>
						<entry>11214</entry>
						<entry>ssl_proxy_downstream_port</entry>
						<entry>Used for SSL XDCR data encryption.</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>Yes</entry>
					</row>
					<row>
						<entry>11215</entry>
						<entry>ssl_proxy_upstream_port</entry>
						<entry>Used for SSL XDCR data encryption.</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>Yes</entry>
					</row>
					<row>
						<entry>18091</entry>
						<entry>ssl_rest_port</entry>
						<entry>Used by the Couchbase Web Console for REST/HTTP traffic with SSL.</entry>
						<entry>No</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>Yes</entry>
					</row>
					<row>
						<entry>18092</entry>
						<entry>ssl_capi_port</entry>
						<entry>Used to access views, run queries, XDCR and update design documents with SSL.</entry>
						<entry>No</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>Yes</entry>
					</row>
					<row>
						<entry>18093</entry>
						<entry>ssl_query_port</entry>
						<entry>N1QL SSL port</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
					</row>
					<row>
						<entry>18094**</entry>
						<entry>fts_ssl_port</entry>
						<entry>External HTTPS port for the Search service</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					<row>
						<entry>4369</entry>
						<entry>epmd_port</entry>
						<entry>Erlang Port Mapper ( <codeph>epmd</codeph> )</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
					</row>
					<row>
						<entry>21100 to 21299 (inclusive)</entry>
						<entry>[Internal data ports]</entry>
						<entry>Node data exchange.</entry>
						<entry>Yes</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No</entry>
						<entry>No </entry>
					</row>
				</tbody>
			</tgroup>
			</table>
		<ul>
			<li>* bi-directional</li>
			<li>** This port was introduced in Couchbase Server 4.5.</li>
			<li>*** This port has to be open for XDCR to connect to target memcached.<note type="note">Ports
					6060 and 11213 are used internally on the local host. They are not used for
					communication between cluster nodes. For firewall purposes, you do not need to
					take these ports into consideration. However, if another service is listening on
					either of these ports, the Couchbase Server service will not start. </note></li>
			
		</ul>


<section><title>User-Defined Ports</title>
	<p>You can install and run Couchbase Server with user-defined ports, overriding the default ports. If you wish
                     to set up multiple nodes per machine, you need to assign unique values to these ports. </p>
	<p>If any of the port numbers that you assign are already in use by other running applications, Couchbase Server will not start.
                    For multiple nodes on the same server, ports must not overlap with the other nodes on that server. Should they do so, you will find Erlang crash notifications in the logs.</p>
	<note type="important">If you want to run Couchbase Server on user-defined ports and with multiple
		instances running on a single machine, note that the standard RPM
		installation for Linux doesnâ€™t allow you to specify separate installation paths needed for
	        separate multiple instances. Therefore, you must perform multiple non-root installations instead.</note>
	<p><b>Setting up Couchbase Server with User-Defined Ports</b></p>
	<ol>
		<li>Install Couchbase Server
			<ul>
				<li>If Couchbase Server is already installed and running, stop it.</li>
			</ul></li>
		<li>Add the new user-defined ports to the <filepath>/opt/couchbase/etc/couchbase/static_config</filepath>
			file [this will be at wherever you put <filepath>&lt;path to>/couchbase/etc/couchbase/static_config</filepath>
                        for multiple node installations]. <ul>
				<li>The <filepath>/opt/couchbase/etc/couchbase/static_config</filepath> is the location
					from where the Couchbase Server picks up the configuration parameters.</li>
				<li>If port numbers are not specified, default ports are used.</li>
				<li>To override some or all default ports, append the user-defined ports to the file.</li>
			</ul></li>
		<li>(Optional) CAPI port (default 8092) can be edited in the
			<filepath>/opt/couchbase/etc/couchdb/default.d/capi.ini</filepath> file by replacing 8092 with the new
			port name.</li>
		<li>If the Couchbase Server was previously configured, delete the
			<filepath>opt/couchbase/var/lib/couchbase/config/config.dat</filepath> file to remove
			the old configuration.</li>
		<li>Start Couchbase Server.</li>
	</ol>
	
	<p><b>How to Map User-Defined Ports to the Default Ports</b></p>
	<p>The port numbers shown in the table above are all reserved, and nothing should be remapped to those numbers. Note, you cannot remap the EPMD port (4369).</p>
	<p>The table below shows how certain user-defined ports can be mapped to the default ports; note the names used in the static_config file are those given in the second column of the table above.: <codeblock>{rest_port, 9000}                    8091 	 Web administration port                                   
{mccouch_port, 8999}                 11213 	Default value for mccouch                         
{memcached_port, 12000}              11211 	Client interface (proxy)
{query_port, 9409}                    8093      Default query port over HTTP
{ssl_query_port, 19409}              18093      Default query port over SSL
{fts_http_port, 9201}                 8094      Default FTS port
{moxi_port, 12001}                   11210 	Internal/external bucket port
{ssl_rest_port,11000}                18091 	Internal REST HTTPS for SSL                                      
{ssl_capi_port,11001}                18092 	Internal CAPI HTTPS for SSL
{ssl_proxy_downstream_port,11002}    11214 	Incoming SSL proxy
{ssl_proxy_upstream_port,11003}      11215 	Internal outgoing SSL proxy</codeblock>
			</p>
</section>		
		
	</body>
</topic>
