<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_npj_srf_2s">
	<title>USE INDEX clause</title>
	<shortdesc>The USE INDEX clause supplies index hints that specify an index to use as part of the
		query execution.  </shortdesc>
	<conbody>
		<section>
			<title>Purpose</title>
			<p>The Rule-Based Optimizer (RBO) is very good at choosing which index is best suited for your
				query; however, if you want to force a manual index selection, you can use the USE
				INDEX clause to specify the index to use as part of the query execution. The query
				engine will use your specified index if it's applicable to the query; and if it
				doesn't exist, then an error will result.</p>
			<p>The following example is detailed in <xref href="#concept_npj_srf_2s/Ex1"
					format="dita">Example
				1</xref>:<codeblock>SELECT sourceairport, airline 
FROM `travel-sample` 
<b>USE INDEX (idx1 USING GSI)</b>
WHERE airline > "M";</codeblock></p>
		</section>
		<section id="section_fpm_d4y_tdb">
			<title>Prerequisites</title>
			<p>For you to select data from a document or keyspace, you must have the<codeph>
					query_select </codeph>privilege on the document or keyspace. <image
					href="images/UseIndex_UserRoles.png" id="image_nqg_frz_tdb" scale="40"/></p>
			<p>For more details about user roles, see <xref
					href="http://docs-build.sc.couchbase.com/server/2070/security/security-authorization.html#authorization"
					format="html" scope="external"><u>Authorization</u></xref>.</p>
		</section>
		<section><title>Syntax</title><codeblock>SELECT <i>field_clause</i> FROM <i>keyspace_ref</i> USE INDEX "(" <i>index_clause</i> [ USING GSI ], <i>index_clause2</i> [ USING GSI ]* ")"

UPDATE <i>keyspace_ref</i> USE INDEX <i>index_clause</i> SET <i>set_clause</i> WHERE <i>where_clause</i>

DELETE FROM <i>keyspace_ref</i> USE INDEX <i>index_clause</i> WHERE <i>where_clause</i> </codeblock>For
			syntax details, see <xref href="update.dita#topic_11_8">UPDATE</xref> and <xref
				href="delete.dita#concept_yzq_ktc_np">DELETE</xref>.</section>
		<section id="section_d4t_wkk_tdb">
			<title>Arguments</title>
			<p>
				<dl>
					<dlentry>
						<dt>field_clause</dt>
						<dd>The field or multiple fields in your projection.</dd>
					</dlentry>
				</dl>
				<dl>
					<dlentry>
						<dt>keyspace_ref</dt>
						<dd>The name of your bucket or keyspace.</dd>
					</dlentry>
				</dl>
				<dl>
					<dlentry>
						<dt>index_clause</dt>
						<dd>The name of your existing index that will be used.</dd>
					</dlentry>
				</dl>
				<dl>
					<dlentry>
						<dt><codeph>USING GSI</codeph></dt>
						<dd>[Optional] Specify using Global Secondary Index.</dd>
					</dlentry>
				</dl>
				<dl>
					<dlentry>
						<dt>set_clause</dt>
						<dd>The expression of the field or fields to be updated.</dd>
					</dlentry>
				</dl>
				<dl>
					<dlentry>
						<dt>where_clause</dt>
						<dd>The expression to filter which documents to be included in the
							projection.</dd>
					</dlentry>
				</dl>
			</p>
		</section>
		<section id="section_lrf_t1r_tdb">
			<title>Examples</title>
			<ul id="ul_jzc_bjs_tdb">
				<li><xref href="#concept_npj_srf_2s/Ex1" format="dita">Ex 1: USE INDEX with
						SELECT</xref></li>
				<li><xref href="#concept_npj_srf_2s/Ex2" format="dita">Ex 2: USE INDEX with
						UPDATE</xref></li>
				<li><xref href="#concept_npj_srf_2s/Ex3" format="dita">Ex 3: USE INDEX with
						DELETE</xref></li>
				<li><xref href="#concept_npj_srf_2s/Ex4" format="dita">Ex 4: Misspelled index in USE
						INDEX clause.</xref></li>
			</ul>
			<p><b id="Ex1">Example 1</b>: USE INDEX with SELECT to specify an index. First, make the index to
				be
				used:<codeblock>CREATE INDEX <b>idx1</b> ON `travel-sample`(airline) USING GSI;</codeblock>Then,
				make a query using the above
				index:<codeblock>SELECT sourceairport, airline 
FROM `travel-sample` 
USE INDEX (<b>idx1</b> USING GSI) 
WHERE airline > "M";</codeblock>Results:<codeblock>[
  {
    "airline": "M5",
    "sourceairport": "BFI"
  },
  {
    "airline": "M5",
    "sourceairport": "BFI"
  },
  {
    "airline": "M5",
    "sourceairport": "CLM"
  },
...</codeblock>Explain
					Plan:<codeblock>{
  "plan": {
    "#operator": "Sequence",
    "~children": [
      {
        "#operator": "IndexScan3",
<b>        "index": "idx1",</b>
...</codeblock><b
					id="Ex2">Example 2:</b> USE INDEX with UPDATE to change all hotel check-out
				times to be <codeph>12pm</codeph>. First, create the
				index:<codeblock>CREATE INDEX <b>idx2</b> ON `travel-sample`(type);</codeblock>Then
				run the update query with the above
					index:<codeblock>UPDATE `travel-sample`
<b>USE INDEX(idx2)</b>
SET checkout = "12pm"
WHERE type = "hotel";</codeblock><b
					id="Ex3">Example 3:</b> USE INDEX with DELETE to remove all hotel documents.
				First, create the
				index:<codeblock>CREATE INDEX <b>idx3</b> ON 'travel-sample`(type);</codeblock>Then
				run the delete query with the above
					index:<codeblock>DELETE FROM `travel-sample`
<b>USE INDEX(idx3)</b>
WHERE type = "hotel"; </codeblock><b
					id="Ex4">Example 4:</b> Misspelled index in USE INDEX clause. Misspelling the
				index name of <xref href="#concept_npj_srf_2s/Ex1" format="dita">Example 1</xref>
				yields an
				error.<codeblock>SELECT sourceairport, airline 
FROM `travel-sample` 
<b>USE INDEX (ixd USING GSI) </b>
WHERE airline > "M";</codeblock>Results:<codeblock>[
  {
    "code": 5000,
    "msg": "GSI index ixd not found.",
    "query_from_user": "SELECT sourceairport, airline \nFROM `travel-sample` \nUSE INDEX (ixd) \nWHERE airline > \"M\";"
  }
]</codeblock></p>
		</section>
	</conbody>
</concept>
