<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE concept
  PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept id="topic_8_2" xtrc="/w:document/w:body[1]/w:p[1257]" xml:lang="en-US">
  <title id="title__Toc272567283">Array Functions</title>
  
 <conbody>
   <p>You can use array functions to evaluate arrays, perform computations on elements in an array, and to return a new array 
     based on a transformation.</p>
   <section id="fn-array-append"><title>ARRAY_APPEND(expression, value, ...)</title>
   <p>This function takes an array and one or more values as arguments and returns a new array with
      the specified value(s) appended. It requires a minimum of two arguments: expression and value,
      and returns an error if there are fewer than two arguments. If one of the values is MISSING,
      then it returns a NULL
      object.<codeblock>SELECT ARRAY_APPEND(t.public_likes, "Valerie Smith") 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": [
      "Julius Tromp I",
      "Corrine Hilll",
      "Jaeden McKenzie",
      "Vallie Ryan",
      "Brian Kilback",
      "Lilian McLaughlin",
      "Ms. Moses Feeney",
      "Elnora Trantow",
      "Valerie Smith"
    ]
  }
]</codeblock></p>
   </section>
   <section id="fn-array-avg"><title>ARRAY_AVG(expression)</title>
   <p>This function takes an array as an argument and returns the arithmetic mean (average) of all
      the non-NULL number values in the array, or NULL if there are no such values.</p>
    <p>If the input value is MISSING, it returns MISSING. If the array size is 0, that is, the array
      does not contain any elements, it returns NULL. Any non-number elements in the array are
      ignored. </p>
<!--   <codeblock spectitle="Syntax"></codeblock>-->
   <codeblock spectitle="Example">SELECT ARRAY_AVG([0,1,1,2,3,5]);
[
  {
    "$1": 2
  }
]</codeblock>
   </section>
   <section id="fn-array-concat"><title>ARRAY_CONCAT(expression1, expression2, ...)</title>
   <p>This function takes two or more expressions as arguments and returns a new array after
      concatenating the input arrays. It returns an error if one of the following conditions holds
      true: <ul id="ul_vd4_fs5_sx">
        <li>there are fewer than two arguments.</li>
        <li>one of the arguments is MISSING.</li>
        <li>one of the array elements is MISSING.</li>
      </ul> It returns NULL if one of the arguments is NULL.
      <codeblock>SELECT ARRAY_CONCAT(t.public_likes, ["John McHill", "Dave Smith"]) 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": [
      "Julius Tromp I",
      "Corrine Hilll",
      "Jaeden McKenzie",
      "Vallie Ryan",
      "Brian Kilback",
      "Lilian McLaughlin",
      "Ms. Moses Feeney",
      "Elnora Trantow",
      "John McHill",
      "Dave Smith"
    ]
  }
]</codeblock></p>
   </section>
   <section id="fn-array-contains"><title>ARRAY_CONTAINS(expression, value)</title>
   <p>This functions checks if the array contains the specified value and returns true if the array
      contains value and false otherwise. If either of the input argument types are missing, it
      returns MISSING. If the first argument is not an array, it returns NULL. </p>
    <p>If the expression is in the WHERE clause of  a partial index, this function lists the
      expressions that are implicitly covered. For Boolean functions,
      <codeblock>SELECT ARRAY_CONTAINS(t.public_likes, "Vallie Ryan") 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": true
  }
]</codeblock></p>
   </section>
   <section id="fn-array-count"><title>ARRAY_COUNT(expression)</title>
   <p>This function returns a count of all the non-NULL values in the array, or zero if there are no
      such values. If the input argument is missing, it returns MISSING. If the argument is not an
      array, it returns a NULL
      value.<codeblock>SELECT ARRAY_COUNT(t.reviews) AS total_reviews
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "total_reviews": 2
  }
]</codeblock></p>
   </section>
   <section id="fn-array-distinct"><title>ARRAY_DISTINCT(expression)</title>
   <p>This function returns a new array with distinct elements of input array. If the input argument
      is MISSING, it returns MISSING. If the argument is a non-array value, it returns NULL.</p>
  <!-- <codeblock spectitle="Syntax"></codeblock>-->
   <codeblock spectitle="Example">SELECT ARRAY_DISTINCT(["apples","bananas","grapes","oranges","apples","mangoes","bananas"]);
[
  {
    "$1": [
      "oranges",
      "grapes",
      "bananas",
      "mangoes",
      "apples"
    ]
  }
]</codeblock>
   </section>
   
   <section id="fn-array-flatten"><title>ARRAY_FLATTEN(expression, depth)</title>
    <p>This function flattens nested array elements into the top-level array, up to the specified
      depth. If one of the arguments is MISSING, it returns MISSING. If the first argument is a
      non-array, or if the second argument is not a number, it returns NULL.</p>
   <codeblock spectitle="Syntax"><varname>array</varname> array_flatten( <varname>array-name</varname>, <varname>depth</varname>)</codeblock>
   <codeblock spectitle="Example">INSERT INTO default 
            (KEY, 
             value) 
VALUES     ("na", 
            {"a":2, "b":[1,2,[31,32,33],4,[[511, 512], 52]]});

SELECT ARRAY_FLATTEN(b,1)
FROM default USE KEYS ["na"];
[
  {
    "$1": [
      1,
      2,
      31,
      32,
      33,
      4,
      [
        511,
        512
      ],
      52
    ]
  }
]

SELECT ARRAY_FLATTEN(b,2)
FROM default USE KEYS ["na"];
[
  {
    "$1": [
      1,
      2,
      31,
      32,
      33,
      4,
      511,
      512,
      52
    ]
  }
]</codeblock>
   </section>
   <section id="fn-array-agg"><title>ARRAY_AGG(expression)</title>
     <p>This function returns an array of the non-MISSING values in the group, including NULL values. It
       returns MISSING if the argument is missing or if one of the elements in the array is missing.</p>
     <codeblock spectitle="Example">SELECT ARRAY_AGG(["abc",1,NULL]);
[
  {
    "$1": [
      [
        "abc",
        1,
        null
      ]
    ]
  }
]</codeblock>
   </section>
   <section id="fn-array-ifnull"><title>ARRAY_IFNULL(expression)</title>
   <p>This function parses the input array and returns the first non-NULL value in the array. It
      returns MISSING if the argument is missing or if one of and NULL if the argument is a non-array.</p>
   <codeblock spectitle="Syntax"><varname></varname> array_ifnull( <varname>array-name</varname>)</codeblock>
   <codeblock spectitle="Example">SELECT ARRAY_IFNULL( ["","apples","","bananas","grapes","oranges"]);
[
  {
    "$1": ""
  }
]

SELECT ARRAY_IFNULL(t.public_likes)
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 2;
[
  {
    "$1": "Julius Tromp I"
  },
  {
    "$1": null
  }
]</codeblock>
   </section>
   <section id="fn-array-insert"><title>ARRAY_INSERT(expression, position, value, ...)</title>
   <p>This function inserts the specified value(s) into the specified position in an array, and
      returns the new array. It requires a minimum of 3 arguments and returns MISSING if any of the
      arguments are missing. It returns NULL if the first argument is a non-array or if the second
      argument is not an integer.
      <codeblock spectitle="Syntax"><varname>array</varname> array_insert( <varname>array-name</varname>, <varname>position</varname>, <varname>value</varname>)</codeblock><codeblock spectitle="Example">SELECT ARRAY_INSERT(schedule, 2, "jsmith")[2]  
FROM `travel-sample` 
WHERE type = "route"  
LIMIT 1;
       {
         "requestID": "c0e073ed-5eca-451d-bcc2-57e2e01ab93d",
         "signature": {
           "$1": "json"
         },
         "results" : [
         {
           "$1": "jsmith"
         }
         ],
         "status": "success",
         "metrics": {
           "elapsedTime": "4.883422ms",
           "executionTime": "4.849777ms",
           "resultCount": 1,
           "resultSize": 38
         }
       }</codeblock></p>
   </section>
   
   <section id="fn-array-intersect"><title>ARRAY_INTERSECT(expression1, expression2, ...)</title>
    <p><i>Since Couchbase Server 4.5.1</i></p>
   <p>This function takes two or more arrays and returns the intersection of the input arrays as the
      result, that is, the array containing values that are present in all the input arrays. It
      returns an empty array if there are no common array elements. It returns MISSING if any of the
      arguments are MISSING, and returns NULL if any of the arguments are non-array
      values.<codeblock spectitle="Examples">SELECT ARRAY_INTERSECT( ["apples","bananas","grapes","orange"], ["apples","orange"], ["apples","grapes"]);
[
  {
    "$1": [
      "apples"
    ]
  }
]

SELECT ARRAY_INTERSECT( ["apples","grapes","oranges"], ["apples"],["oranges"],["bananas", "grapes"]);
[
  {
    "$1": []
  }
]</codeblock></p>
   </section>
   <section id="fn-array-length"><title>ARRAY_LENGTH(expression)</title>
   <p>This function returns the number of elements in the array. It returns MISSING if the argument
      is MISSING, and returns NULL if the argument is a non-array
      value.<codeblock spectitle="Example">SELECT ARRAY_LENGTH(t.public_likes) AS total_likes 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "total_likes": 8
  }
]</codeblock></p>
   </section>
   <section id="fn-array-max"><title>ARRAY_MAX(expression)</title>
   <p>This function returns the largest non-NULL, non-MISSING array element, in N1QL collation
      order. It returns MISSING if the argument is MISSING and returns NULL if the argument is a
      non-array
      value.<codeblock>SELECT ARRAY_MAX(t.public_likes) 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": "Vallie Ryan"
  }
]</codeblock></p>
   </section>
   <section id="fn-array-min"><title>ARRAY_MIN(expression)</title> 
   <p>This function returns the smallest non-NULL, non-MISSING array element, in N1QL collation
      order. It returns MISSING if the argument is MISSING and returns NULL if the argument is a
      non-array
      value.<codeblock>SELECT ARRAY_MIN(t.public_likes) 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": "Brian Kilback"
  }
]</codeblock></p>
   </section>
   <section id="fn-array-position"><title>ARRAY_POSITION(expression, value)</title>
   <p>This function returns the first position of the specified value within the array. The array
      position is zero-based, that is, the first position is 0. It returns -1 if the values does not
      exist in the array. It returns MISSING if one of the arguments is MISSING, and returns NULL if
      the arguments are non-array
      values.<codeblock>SELECT ARRAY_POSITION(t.public_likes, "Brian Kilback") FROM `travel-sample` t WHERE type="hotel" LIMIT 1;
[
  {
    "$1": 4
  }
]</codeblock></p>
   </section>
   <section id="fn-array-prepend"><title>ARRAY_PREPEND(value, ... , expression)</title>
   <p>This function returns the new array after prepending the array with the specified values. It
      requires a minimum of two arguments. It returns MISSING if one of the arguments is MISSING,
      and returns NULL if the last argument is a
      non-array.<codeblock>SELECT ARRAY_PREPEND("Dave Smith",t.public_likes) 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": [
      "Dave Smith",
      "Julius Tromp I",
      "Corrine Hilll",
      "Jaeden McKenzie",
      "Vallie Ryan",
      "Brian Kilback",
      "Lilian McLaughlin",
      "Ms. Moses Feeney",
      "Elnora Trantow"
    ]
  }
]</codeblock></p>
   </section>
   <section id="fn-array-put"><title>ARRAY_PUT(expression, value, ...)</title>
   <p>This function returns a new array with value(s) appended if the value is not already present.
      Otherwise, it returns the unmodified input array. It requires a minimum of two arguments. It
      returns MISSING if one of the arguments is MISSING, and returns NULL if the first argument is
      a
      non-array.<codeblock>SELECT ARRAY_PUT(t.public_likes, "Dave Smith") 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": [
      "Julius Tromp I",
      "Corrine Hilll",
      "Jaeden McKenzie",
      "Vallie Ryan",
      "Brian Kilback",
      "Lilian McLaughlin",
      "Ms. Moses Feeney",
      "Elnora Trantow",
      "Dave Smith"
    ]
  }
]</codeblock></p>
   </section>
   <section id="fn-array-range"><title>ARRAY_RANGE(start, end [, step ])</title>
   <p>This function returns a new array of numbers, from <userinput>start</userinput> until the
      largest number less than <userinput>end</userinput>. Successive numbers are incremented by
        <userinput>step</userinput>. If <userinput>step</userinput> is not specified, the default
      value of 1 is used. If <userinput>step</userinput> is negative, the function decrements until
      the smallest number greater than <userinput>end</userinput>. It returns MISSING if any of the
      arguments are MISSING, and returns NULL if any of the arguments are non-numbers.</p>
   <codeblock spectitle="Example">SELECT ARRAY_RANGE(0, 25, 5);
[
  {
    "$1": [
      0,
      5,
      10,
      15,
      20
    ]
  }
]  

SELECT ARRAY_RANGE(0.1, 2);
[
  {
    "$1": [
      -1,
      0,
      1
    ]
  }
] 

SELECT ARRAY_RANGE(10, 3, -3);
[
  {
    "$1": [
      10,
      7,
      4
    ]
  }
]</codeblock>
   </section>
   <section id="fn-array-remove"><title>ARRAY_REMOVE(expression, value, ...)</title>
   <p>This function returns a new array with all occurrences of the specified value(s) removed. It
      requires a minimum of two arguments. It returns MISSING if any of the arguments are MISSING,
      and returns NULL if the first argument is not an
      array.<codeblock>SELECT ARRAY_REMOVE(t.public_likes, "Vallie Ryan") 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": [
      "Julius Tromp I",
      "Corrine Hilll",
      "Jaeden McKenzie",
      "Brian Kilback",
      "Lilian McLaughlin",
      "Ms. Moses Feeney",
      "Elnora Trantow"
    ]
  }
]</codeblock></p>
   </section>
   <section id="fn-array-repeat"><title>ARRAY_REPEAT(value, n)</title>
   <p>This function returns a new array with the specified value repeated <userinput>n</userinput>
      times.  It returns MISSING if any of the arguments are MISSING, and returns NULL if the first
      argument is not an integer.</p><codeblock spectitle="Example">SELECT ARRAY_REPEAT("Vallie Ryan", 3);
[
  {
    "$1": [
      "Vallie Ryan",
      "Vallie Ryan",
      "Vallie Ryan"
    ]
  }
]</codeblock>
   </section>
   <section id="fn-array-replace"><title>ARRAY_REPLACE(expression, value1, value2 [, n ])</title>
   <p>This function returns a new array with all occurrences of <userinput>value1</userinput>
      replaced with <userinput>value2</userinput>. If n is specified, at most
        <userinput>n</userinput> replacements are performed. It returns MISSING if any of the
      arguments are missing, and returns NULL if the first argument is not an array, or if the
      second argument is
      NULL.<codeblock>SELECT ARRAY_REPLACE(t.public_likes, "Vallie Ryan", "Valerie Ryan") 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": [
      "Julius Tromp I",
      "Corrine Hilll",
      "Jaeden McKenzie",
      "Valerie Ryan",
      "Brian Kilback",
      "Lilian McLaughlin",
      "Ms. Moses Feeney",
      "Elnora Trantow"
    ]
  }
]</codeblock></p>
   </section>
   <section id="fn-array-reverse"><title>ARRAY_REVERSE(expression)</title>
   <p>This function returns a new array with all the elements in reverse order. It returns MISSING
      if the argument is MISSING, and returns NULL if the argument is a non-array
      value.<codeblock>SELECT ARRAY_REVERSE(t.public_likes) 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": [
      "Elnora Trantow",
      "Ms. Moses Feeney",
      "Lilian McLaughlin",
      "Brian Kilback",
      "Vallie Ryan",
      "Jaeden McKenzie",
      "Corrine Hilll",
      "Julius Tromp I"
    ]
  }
]</codeblock></p>
</section>
   <section id="fn-array-sort"><title>ARRAY_SORT(expression)</title>
   <p>This function returns a new array with the elements sorted in N1QL collation order. It returns
      MISSING if the argument is MISSING, and returns NULL if the argument is a non-array
      value.<codeblock spectitle="Example">SELECT ARRAY_SORT(t.public_likes) 
FROM `travel-sample` t 
WHERE type="hotel" 
LIMIT 1;
[
  {
    "$1": [
      "Brian Kilback",
      "Corrine Hilll",
      "Elnora Trantow",
      "Jaeden McKenzie",
      "Julius Tromp I",
      "Lilian McLaughlin",
      "Ms. Moses Feeney",
      "Vallie Ryan"
    ]
  }
]</codeblock></p>
</section>
   <section id="fn-array-star"><title>ARRAY_STAR(expression)</title>
    <p>This function converts an array of objects into an object of arrays. It returns MISSING if
      the argument is MISSING, and returns NULL if the argument is a non-array value.</p>
    <p>
      <!--<codeblock spectitle="Syntax"></codeblock>-->
      <codeblock spectitle="Example">SELECT ARRAY_STAR( [
   {
    "address": "Capstone Road, ME7 3JE",
    "city": "Medway",
    "country": "United Kingdom",
    "name": "Medway Youth Hostel",
    "url": "http://www.yha.org.uk"
  },
  {
    "address": "6 rue aux Juifs",
    "city": "Giverny",
    "country": "France",
    "name": "The Robins",
    "url": "http://givernyguesthouse.com/robin.htm"
  }]);

[
  {
    "$1": {
      "address": [
        "Capstone Road, ME7 3JE",
        "6 rue aux Juifs"
      ],
      "city": [
        "Medway",
        "Giverny"
      ],
      "country": [
        "United Kingdom",
        "France"
      ],
      "name": [
        "Medway Youth Hostel",
        "The Robins"
      ],
      "url": [
        "http://www.yha.org.uk",
        "http://givernyguesthouse.com/robin.htm"
      ]
    }
  }
]</codeblock>
    </p></section>
   <section id="fn-array-sum"><title>ARRAY_SUM(expression)</title>
   <p>This function returns the sum of all the non-NULL number values in the array, or zero if there
      are no number values.</p>
    <p>It returns MISSING if the argument is MISSING, and returns NULL if the argument is a
      non-array value. </p>
   <codeblock spectitle="Syntax">number ARRAY_SUM(array);</codeblock>
    <codeblock spectitle="Example">SELECT ARRAY_SUM([0,1,1,2,3,5]);
[
  {
    "$1": 12
  }
]</codeblock>
   
   <p><b>Array references ( doc.f[*].id )</b></p>
   <p>You can use an asterisk (*) as an array subscript which converts the array to an object of
      arrays. The following example returns an array of the ages of the given contactâ€™s children:
      <codeblock>SELECT children[*].age FROM contacts WHERE fname = "Dave"</codeblock></p>
   <p> An equivalent query can be written using the <apiname>array_star()</apiname> function:
      <codeblock>SELECT array_star(children).age FROM contacts WHERE fname = "Dave"</codeblock></p>
   </section>
 </conbody>
</concept>
