<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Couchbase Cluster Configuration :: Couchbase // Docs (Demo)</title>
    <link rel="stylesheet" href="../../_/css/site.css">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<link rel="shortcut icon" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/favicon.ico" type="image/x-icon">
<link rel="icon" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" sizes="57x57" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"Â  href="/webfiles/1498186094252/images/icons/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/favicon-16x16.png">
<link rel="manifest" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/webfiles/1498186094252/images/icons/favicon/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<!--    _____________________________
_______/ Support for legacy browsers \_______________________________________-->
<!--[if lte IE 8]>
<script type="text/javascript" charset="utf-8" src="/webfiles/1498186094252/js/thirdparty/vendor/html5shiv.js" />
<script type="text/javascript" charset="utf-8" src="/webfiles/1498186094252/js/thirdparty/vendor/respond.js" />
<![endif]-->
<!--[if IE 9]>
<script type="text/javascript" charset="utf-8" src="/webfiles/1498186094252/js/thirdparty/classList.js" />
<![endif]-->
<!--_________________________________________________________________________-->
<script type="text/javascript" charset="utf-8" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" charset="utf-8" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/jquery-migrate.js"></script>
<script type="text/javascript" charset="utf-8" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/slick.js"></script>
<script type="text/javascript" charset="utf-8" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/isotope.min.js"></script>
<script type="text/javascript" charset="utf-8" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/imagesloaded.min.js"></script>

<meta name="apple-mobile-web-app-title" content="Couchbase">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-site-verification" content="1gPO0RaMzKyZJFpS-iyIEnPsWDztwZH0R3vG1VpSwvM" />

<!-- LOCAL CSS Libs -->
<link rel="stylesheet" href="https://developer.couchbase.com/webfiles/1498186094252/css/styles.css">

<!-- Default canonical comes from the URL -->
<link rel="canonical" href="http://developer.couchbase.com"/>
<title>Couchbase</title>
<link rel="stylesheet" href="https://developer.couchbase.com/binaries/content/assets/css/overrides.css">
  </head>
  <body>
<!-- Google Tag Manager -->
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0"
          width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager -->
<script>
  var overrideJsPath = "/binaries/content/assets/js/overrides.js";
  $.ajax({
    url: overrideJsPath,
    type: 'HEAD',
    error: function () {
    },
    success: function () {
      // file exists
      $.getScript(overrideJsPath);
    }
  });
</script>
<!--    ________________
_______/ INCLUDE HEADER - BODY - FOOTER \____________________________________________________-->
<!-- begin - include ref= -->
<nav class="aux">
  <div>
  </div>
</nav>
<!-- Beginning of site.../jsp/base/header.jsp -->
<header id="global-header" class="global-header dev-portal">
  <div class="layout-wrapper">
    <div class="global-header__logo">
      <a href='http://www.couchbase.com'>Couchbase</a>
      <a href='index.html'>Developer</a>

    </div>

    <a data-modules="navigation,globalheadersearch"></a>
    <nav role="navigation" id="primary-navigation" class="primary-navigation">
      <button aria-controls="primary-navigation__wrapper"
              aria-pressed="false"
              class="primary-navigation__toggler"
              type="button">

        <span>Menu</span>
      </button>
      <div id="primary-navigation__wrapper"
           class="primary-navigation__wrapper"
           aria-expanded="false">

        <ul class="primary-navigation__items">
          <li class="primary-navigation__item ">

            <a href="https://developer.couchbase.com/documentation/server/current/introduction/intro.html">Server</a>
          </li>
          <li class="primary-navigation__item ">

            <a href="https://developer.couchbase.com/mobile">Mobile</a>
          </li>
          <li class="primary-navigation__item has-secondary-navigation">

            <a href="https://developer.couchbase.com/community">Community</a>
            <div class="secondary-navigation">
              <ul class="secondary-navigation__items">
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/open-source-projects">Open Source Projects</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/contribute">Contribute</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="http://www.couchbase.com/nosql-resources/events">Events</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/experts-and-champions">Experts &amp; Champions</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="http://forums.couchbase.com/">Forums</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="http://blog.couchbase.com">Blogs</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/support">Support</a>
                </li>
              </ul>
            </div>
          </li>
          <li class="primary-navigation__item has-secondary-navigation">

            <a href="https://developer.couchbase.com/guides-and-references">Site Map</a>
            <div class="secondary-navigation">
              <ul class="secondary-navigation__items">
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/guides-and-references#section-1">Couchbase Server</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/guides-and-references#section-2">Couchbase Mobile</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/guides-and-references#subsection-1-3">SDKs</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/guides-and-references#subsection-1-5">Connectors</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/documentation-archive">Documentation Archive</a>
                </li>
              </ul>
            </div>
          </li>
        </ul>
        <form id="global-header-search"
              autocomplete="off"
              class="global-header-search global-header-search--js"
              action="https://developer.couchbase.com/search"
              aria-expanded="false">
          <ul><!--
            ---><li>
            <label for="global-header-search__query">
              Search query
            </label>
            <input
              type="search"
              placeholder="Search"
              name="q"
              value=""
              id="global-header-search__query">
          </li><!--
                ---><li>
            <button type="submit">
              <span>Search</span>
            </button>
          </li><!--
        ---></ul>
          <button aria-controls="global-header-search__items"
                  aria-pressed="false"
                  class="global-header-search__toggler"
                  type="button">
            <span>Search</span>
          </button><!--
        --->

          <div style="display: none" about="custom-search-fields">

            <input type="hidden"
                   name="cx"
                   value="017928787631531434501:3e7lwhjxsom" />
            <input type="hidden"
                   name="cof"
                   value="FORID:11" />
            <input type="hidden"
                   name="safe"
                   value="off" />
            <input type="hidden"
                   name="form_build_id"
                   value="form-RrbKDUhO3kB2MiqBdZHIQI9L4LFE7c3L_s87N2B9BZo" />
            <input type="hidden"
                   name="form_id"
                   value="google_cse_results_searchbox_form" />
            <input type="hidden"
                   name="siteurl"
                   value='developer.couchbase.com' />

          </div>
        </form>
      </div>
    </nav>
    <a class="global-header__download-button" href="https://developer.couchbase.com/downloads">
      Download
    </a>
  </div>
</header>
<div class="main-wrapper">
<div class="navigation-container">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <span class="nav-text"></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Couchbase Operator User&#8217;s Guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="prerequisiteAndSetup.html">Prerequisites and Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operatorConfig.html">Couchbase Operator Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="deployingCouchbase.html">Deploying a Couchbase Cluster</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="couchbaseClusterConfig.html">CouchbaseCluster Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="clusterStatusGuide.html">Displaying the Status of a CouchbaseCluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="listAndDescribe.html">Viewing the Pods/Services Created</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="accessingCouchbase.html">Accessing Couchbase</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adminConsoleAccess.html">Couchbase Web Console</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="couchbaseCliGuide.html">Couchbase CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="runningCouchbase.html">Running Couchbase on Kubernetes/OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scalingCouchbase.html">Scaling a CouchbaseCluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="nodeRecovery.html">Recovering from a Node Failure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="updatingCouchbase.html">Updating a CouchbaseCluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="deleteCouchbaseCluster.html">Deleting a CouchbaseCluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="logsTroubleshooting.html">Logs and Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="conditionsAndEvents.html">Conditions and Events</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="demo.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="releaseNotes.html">v0.7 Beta Release Notes</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="current" style="display: none;">
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Couchbase Lite Core</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../couchbase-lite-core/docs/replication-protocol.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Couchbase Operator User's Guide</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="overview.html">beta</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">kafka</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../kafka/0.1/quickstart.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">swift</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../swift/0.1/overview.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tutorials</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../tutorials/0.1/overview.html">0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
  <ul>
    <li class="crumb">Couchbase Operator User&#8217;s Guide</li>
    <li class="crumb"><a href="deployingCouchbase.html">Deploying a Couchbase Cluster</a></li>
    <li class="crumb"><a href="couchbaseClusterConfig.html">CouchbaseCluster Configuration</a></li>
  </ul>
</nav>
</div>
    <div class="body">
<article class="doc">
<h1>Couchbase Cluster Configuration</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The following sample CouchbaseCluster configuration file lists all the
configuration parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.database.couchbase.com/v1beta1
kind: CouchbaseCluster
metadata:
  name: cb-example
  namespace: default
spec:
  baseImage: couchbase/server
  version: enterprise-5.0.1
  paused: false
  antiAffinity: true
  authSecret: my-secret
  exposeAdminConsole: true
  adminConsoleServices:
    - data
  cluster:
    dataServiceMemoryQuota: 256
    indexServiceMemoryQuota: 256
    searchServiceMemoryQuota: 256
    indexStorageSetting: default
    autoFailoverTimeout: 30
  buckets:
    - name: default
      type: couchbase
      memoryQuota: 1024
      replicas: 1
      ioPriority: high
      eviction-policy: value-eviction
      conflictResolution: seqno
      enableFlush: true
      enableIndexReplica: false
  servers:
    - size: 1
      name: all_services
      services:
        - data
        - index
        - query
        - search
      dataPath: /opt/couchbase/var/lib/couchbase/data
      indexPath: /opt/couchbase/var/lib/couchbase/data
      pod:
        couchabseEnv:
          ENV1: value
        resources:
          limits:
            cpu: 4GHz
            memory: 8GiB
            storage: 100GiB
          requests:
            cpu: 2GHz
            memory: 8GiB
            storage: 50GiB
        labels:
          couchbase_services: all
        nodeSelector:
          instanceType: large
        tolerations:
          key: app
          operator: Equal
          value: cbapp
          effect: NoSchedule
        automountServiceAccountToken: false</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="top-level-definitions"><a class="anchor" href="#top-level-definitions"></a>Top-Level Definitions</h3>
<div class="paragraph">
<p>The following parameters are the top level parameters for a
CouchbaseCluster configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.database.couchbase.com/v1beta1
kind: CouchbaseCluster
metadata:
  name: cb-example
  namespace: default
spec:
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>apiversion</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the API Version for our integration. As our
integration changes over time, you can change the API Version whenever
new features are added. For any given release, the API Versions
supported by that Operator will be specified in our documentation. We
also always recommend that you upgrade to the latest API Version when
possible.<br>
<em>Field rules:</em> This field is required and must be set to a valid API
version. The value of this field cannot be changed after the cluster is
created.</p>
</div>
<div class="paragraph">
<p><strong>kind</strong></p>
</div>
<div class="paragraph">
<p>This field specifies that this Kubernetes configuration will use the
custom Couchbase controller to manage the cluster.<br>
<em>Field rules:</em> This field is required and must always be set to
CouchbaseCluster. The value of this field cannot be changed after the
cluster is created.</p>
</div>
<div class="paragraph">
<p><strong>metadata</strong></p>
</div>
<div class="paragraph">
<p>Allows setting a name for the Couchbase cluster and a namespace that the
cluster should be deployed in.<br>
<em>Field rules:</em> A name is highly recommended, but not required. If values
are not set in the metadata field then defaults will be set. The value
of <code>name</code> will be autogenerated and the value of <code>namespace</code> will be set
to ``default''. The value of these fields cannot be changed after the
cluster is created.</p>
</div>
<div class="paragraph">
<p><strong>spec</strong></p>
</div>
<div class="paragraph">
<p>This field contains the specification on how the Couchbase cluster must
be deployed.</p>
</div>
</div>
<div class="sect2">
<h3 id="spec-the-top-level"><a class="anchor" href="#spec-the-top-level"></a>Spec: The Top-Level</h3>
<div class="paragraph">
<p>Defines top level parameters related to a Couchbase cluster deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">...
  baseImage: couchbase/server
  version: enterprise-5.0.1
  paused: false
  antiAffinity: true
  authSecret: my-auth-secret
  exposeAdminConsole: true
  adminConsoleServices:
    - data
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>baseImage</strong> This field specifies the image that should be used.<br>
<em>Field rules:</em> The <code>baseImage</code> field is required and should be set to
``couchbase/server'' unless you want Kubernetes to pull the Couchbase
Server docker container from a different location. The value of this
field cannot be changed after the cluster is created.</p>
</div>
<div class="paragraph">
<p><strong>version</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the version number of Couchbase Server to install.
This should match an available version number in the Couchbase Docker
repository. It may never be changed to a lower version number than the
version that is currently running.<br>
<em>Field rules:</em> The <code>version</code> field is required and should be set to the
version of Couchbase Server that should be used to build the cluster. At
the time of this writing, the Couchbase Operator has only been tested
with enterprise-5.0.1. The value of this field cannot be changed after
the cluster is created.</p>
</div>
<div class="paragraph">
<p><strong>paused</strong></p>
</div>
<div class="paragraph">
<p>This field specifies whether or not the Operator is currently managing
this cluster. This parameter should generally be set to true, but may be
set to false if you decide to make manual changes to the cluster. By
disabling the Operator you can change the cluster configuration without
having to worry about the Operator reverting the changes. However,
before re-enabling the Operator, ensure that the Kubernetes
configuration matches the cluster configuration.<br>
<em>Field rules:</em> The <code>paused</code> field is not required and defaults to false
if not specified.</p>
</div>
<div class="paragraph">
<p><strong>antiAffinity</strong></p>
</div>
<div class="paragraph">
<p>This field specifies whether or not two pods in this cluster can be
deployed on the same Kubernetes node. In a production setting this
parameter should always be set to true in order to reduce the chance of
data loss incase a Kubernetes Node crashes.<br>
<em>Field rules:</em> The <code>antiAffinity</code> field is not required and defaults to
false if not specified. The value of this field cannot be changed after
the cluster is created.</p>
</div>
<div class="paragraph">
<p><strong>authSecret</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the name of a Kubernetes Secret that should be used
as the user name and password of the Couchbase super-user.<br>
<em>Field rules:</em> The <code>authSecret</code> field is required and should reference
the name of a
<a href="https://kubernetes.io/docs/concepts/configuration/secret/">Kubernetes
Secret</a> that already exists. The value of this field cannot be changed
after the cluster is created.</p>
</div>
<div class="paragraph">
<p><strong>exposeAdminConsole</strong></p>
</div>
<div class="paragraph">
<p>This field specifies whether or not the Couchbase Web Console should be
exposed externally. Exposing the Web Console is done using a NodePort
service and the port for the service can be found in the describe output
when describing this cluster. This parameter may be changed while the
cluster is running and the Operator will create/destroy the NodePort
service as appropriate.<br>
<em>Field rules:</em> The <code>exposeAdminConsole</code> field is not required and
defaults to false if not specified.</p>
</div>
<div class="paragraph">
<p><strong>adminConsoleServices</strong></p>
</div>
<div class="paragraph">
<p>When the Couchbase Web Console is exposed, the pod that it is connected
to is chosen based on the client IP address. Since the Web Console may
display slightly different features based on the services running on the
particular pod it is connected to, we let you specify the services so
that the exposed port will only connect to pods that contain the
services specified for this parameter. A list of one or more services
should be provided. If you do not specify any service, then the Web
Console will be connected to all pods in the cluster.<br>
<em>Field rules:</em> The <code>adminConsoleServices</code> list is not required and
defaults to an empty list. An empty list means any node in the cluster
may be chosen when connecting to the Web Console.</p>
</div>
</div>
<div class="sect2">
<h3 id="spec-the-cluster-settings"><a class="anchor" href="#spec-the-cluster-settings"></a>Spec: The Cluster Settings</h3>
<div class="paragraph">
<p>This section specifies the various Couchbase cluster settings. This
section is not meant to encompass every setting that is configurable on
Couchbase. Cluster settings not mentioned here can be managed manually.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">...
  cluster:
    dataServiceMemoryQuota: 4096
    indexServiceMemoryQuota: 1024
    searchServiceMemoryQuota: 2048
    indexStorageType: plasma
    autoFailoverTimeout: 30
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>dataServiceMemoryQuota</strong></p>
</div>
<div class="paragraph">
<p>The amount of memory to assign to the data service if present on a
specific Couchbase node in MiB.<br>
<em>Field rules:</em> The <code>dataServiceMemoryQuota</code> field is required and must
be set to be greater than or equal to 256. Keep in mind that the sum of
all memory quotas must be no more than 80% of a pods available memory.</p>
</div>
<div class="paragraph">
<p><strong>indexServiceMemoryQuota</strong></p>
</div>
<div class="paragraph">
<p>The amount of memory to assign to the index service if present on a
specific Couchbase node in MiB.<br>
<em>Field rules:</em> The <code>indexServiceMemoryQuota</code> field is required and must
be set to be greater than or equal to 256. Keep in mind that the sum of
all memory quotas must be no more than 80% of a pods available memory.</p>
</div>
<div class="paragraph">
<p><strong>searchServiceMemoryQuota</strong></p>
</div>
<div class="paragraph">
<p>The amount of memory to assign to the search service if present on a
specific Couchbase node in MiB. This parameter defaults to 256MiB if it
is not set.<br>
<em>Field rules:</em> The <code>searchServiceMemoryQuota</code> field is required and must
be set to be greater than or equal to 256. Keep in mind that the sum of
all memory quotas must be no more than 80% of a pods available memory.</p>
</div>
<div class="paragraph">
<p><strong>indexStorageType</strong></p>
</div>
<div class="paragraph">
<p>Specifies the backend storage type to use for the index service. If the
cluster already contains a Couchbase Server instance running the index
service, then this parameter cannot be changed until all Couchbase
instances running the index service are removed.<br>
<em>Field rules:</em> The <code>indexStorageType</code> is required and must be set to
either <code>plasma'' or </code>memory-optimized''. The value of this field can
only be changed if there are no index nodes in the cluster.</p>
</div>
<div class="paragraph">
<p><strong>autoFailoverTimeout</strong></p>
</div>
<div class="paragraph">
<p>Specifies the auto-failover timeout in seconds. The Operator relies on
the CouchbaseCluster to auto-failover nodes before removing them, so
setting this field to an appropriate value is important.<br>
<em>Field rules:</em> The <code>autoFailoverTimeout</code> is required and must be greater
than or equal to 5.</p>
</div>
</div>
<div class="sect2">
<h3 id="spec-bucket-settings"><a class="anchor" href="#spec-bucket-settings"></a>Spec: Bucket Settings</h3>
<div class="paragraph">
<p>This section defines one or more buckets that must be created in the
cluster. Note that if you remove an already specified bucket from the
configuration, the Operator will delete that bucket from the cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">...
  buckets:
    - name: default
      type: couchbase
      memoryQuota: 1024
      replicas: 1
      ioPriority: high
      evictionPolicy: value-eviction
      conflictResolution: seqno
      enableFlush: true
      enableIndexReplica: false
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>name</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the name of the bucket. This parameter is required
when specifying a bucket.<br>
<em>Field rules:</em> The <code>name</code> is required and must be a string using
characters and numbers. The value of this field cannot be changed after
the bucket is created.</p>
</div>
<div class="paragraph">
<p><strong>type</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the type of bucket to create. This parameter can be
set to <code>couchbase'', </code>ephemeral'', or <code>memcached''. If the type is
not specified, it defaults to </code>couchbase''.<br>
<em>Field rules:</em> The <code>type</code> is required and must be set to either
<code>couchbase'', </code>ephemeral'', or ``memcached''. The value of this field
cannot be changed after the bucket is created.</p>
</div>
<div class="paragraph">
<p><strong>memoryQuota</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the amount of memory to allocate to this bucket in
MiB. If the quota is not specified, it defaults to 100MiB.<br>
<em>Field rules:</em> The <code>memoryQuota</code> is required and must be set greater
than or equal to 100.</p>
</div>
<div class="paragraph">
<p><strong>replicas</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the number of replica that should be created for
this bucket. This value may be set between 0 and 3 inclusive. If the
number is not set, it defaults to 1. Note that this parameter has no
effect for the memcached bucket type.<br>
<em>Field rules:</em> The <code>replicas</code> field is required for buckets with type
<code>couchbase'' and </code>ephemeral'' and must be set between 0 and 3.
Memcached buckets will ignore values in this field. Changing the value
of this field will cause a rebalance to occur.</p>
</div>
<div class="paragraph">
<p><strong>ioPriority</strong></p>
</div>
<div class="paragraph">
<p>This field sets the IO priority of background threads for this bucket.
This option is valid for Couchbase and Ephemeral buckets only. Memcached
buckets will ignore values in this field.<br>
<em>Field rules:</em> The <code>ioPriority</code> is required for buckets with type
<code>couchbase'' and </code>ephemeral'' and must be set to either <code>high'' or
</code>low''. Memcached buckets will ignore values in this field. Changing
the value of this field will cause downtime while the bucket is
restarted.</p>
</div>
<div class="paragraph">
<p><strong>evictionPolicy</strong></p>
</div>
<div class="paragraph">
<p>This field sets the memory-cache eviction policy for this bucket. This
option is valid for Couchbase and Ephemeral buckets only.</p>
</div>
<div class="paragraph">
<p>Couchbase buckets support either <code>valueOnly'' or </code>fullEviction''.
Specifying the <code>valueOnly'' policy means that each key stored in this
bucket must be kept in memory. This is the default policy; using this
policy improves the performance of key-value operations, but limits the
maximum size of the bucket. Specifying the </code>fullEviction'' policy means
that the performance is impacted for key-value operations, but the
maximum size of the bucket is unbounded.</p>
</div>
<div class="paragraph">
<p>Ephemeral buckets support either <code>noEviction'' or </code>nruEviction''.
Specifying <code>noEviction'' means that the bucket will not evict items
from the cache if the cache is full. This type of eviction policy should
be used for in-memory database use cases. Specifying </code>nruEviction''
means that items not recently used will be evicted from memory when all
the memory in the bucket is used. This type of eviction policy should be
used for caching use cases.<br>
<em>Field rules:</em> The <code>evictionPolicy</code> is required for buckets with type
<code>couchbase'' and </code>ephemeral''. Memcached buckets will ignore values in
this field. Changing the value of this field will cause downtime while
the bucket is restarted.</p>
</div>
<div class="paragraph">
<p><strong>conflictResolution</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the bucketâs conflict resolution mechanism which is
to be used if a conflict occurs during cross datacenter
replication(XDCR). There are two supported mechanisms: sequence-based
and timestamp-based.</p>
</div>
<div class="paragraph">
<p>The sequence-based conflict resolution mechanism selects the document
that has been updated the greatest number of times since the last sync.
For example, if one cluster has updated a document twice since the last
sync, and the other cluster has updated the document three times, the
document updated three times is selected regardless of the specific
times at which these updates took place.</p>
</div>
<div class="paragraph">
<p>The timestamp-based conflict resolution mechanism selects the document
with the most recent timestamp. This is only supported when all clocks
on all the nodes are fully synchronized.<br>
<em>Field rules:</em> The <code>conflictResolution</code> field is required for buckets
with type <code>couchbase'' and </code>ephemeral'' and can be set to either
<code>seqno'' or </code>lww''. Memcached buckets will ignore values in this
field. The value of this field may not be changed after the bucket has
been created.</p>
</div>
<div class="paragraph">
<p><strong>enableFlush</strong></p>
</div>
<div class="paragraph">
<p>This field specifies whether or not to enable the flush command on this
bucket. This parameter defaults to false if it is not specified. This
parameter only affects Couchbase and Ephemeral buckets.<br>
<em>Field rules:</em> The <code>enableFlush</code> field can be set to either true or
false. If defaults to false.</p>
</div>
<div class="paragraph">
<p><strong>enableIndexReplicas</strong></p>
</div>
<div class="paragraph">
<p>This field specifies whether or not to enable view index replicas for
this bucket. This parameter defaults to false if it is not specified.
This parameter only affects Couchbase buckets.<br>
<em>Field rules:</em> The <code>enableIndexReplicas</code> field is required for buckets
with type ``couchbase'' and can be set to either true or false.
Memcached and ephemeral buckets will ignore values in this field.</p>
</div>
</div>
<div class="sect2">
<h3 id="spec-servers"><a class="anchor" href="#spec-servers"></a>Spec: Servers</h3>
<div class="paragraph">
<p>You must specify at least one, but possibly multiple node
specifications. A node specification is used to allow multi-dimensional
scaling of a Couchbase cluster with Kubernetes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">...
  servers:
  - size: 1
    name: all_services
    services:
      - data
      - index
      - query
      - search
    dataPath: /opt/couchbase/var/lib/couchbase/data
    indexPath: /opt/couchbase/var/lib/couchbase/data
    pod:
      couchabseEnv:
        CB_ENV_VAR: value
      resources:
        limits:
          cpu: 4GHz
          memory: 8GiB
          storage: 100GiB
        requests:
          cpu: 2GHz
          memory: 8GiB
          storage: 50GiB
      labels:
        couchbase_services: all
      nodeSelector:
        instanceType: large
      tolerations:
        key: app
        operator: Equal
        value: cbapp
        effect: NoSchedule</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Specification rules:</em> The <code>servers</code> portion of the specification is
required and must always contain at least one server definition. There
must also be at least one definition that contains the data service.</p>
</div>
<div class="paragraph">
<p><strong>size</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the number of nodes of this type that should be in
the cluster. This allows the user to scale up different parts of the
cluster as necessary. If this parameter is changed at runtime, the
Operator will automatically scale the cluster.<br>
<em>Field rules:</em> The <code>size</code> is required and can be set set greater than or
equal to 1.</p>
</div>
<div class="paragraph">
<p><strong>name</strong></p>
</div>
<div class="paragraph">
<p>This field specifies a name for this group of servers.<br>
<em>Field rules:</em> The <code>name</code> field is required and must be unique in
comparison to the <code>name</code> field of other server definitions. The value of
this field cannot be changed after a server has been defined.</p>
</div>
<div class="paragraph">
<p><strong>services</strong></p>
</div>
<div class="paragraph">
<p>This field specifies a list of services that should be run on nodes of
this type. Users can specify data, index, query, and search in the list.
At least one service must be specified and all clusters must contain at
least one node specification that includes the data service.<br>
<em>Field rules:</em> The <code>services</code> list is required and must contain at least
one service. Valid values for services are <code>data'', </code>index'',
<code>query'', and </code>search''. The values of this list cannot be changed
after a server has been defined.</p>
</div>
<div class="paragraph">
<p><strong>dataPath</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the path where data from the data service should be
stored. This parameter is required.<br>
<em>Field rules:</em> The <code>dataPath</code> is required and be set to a valid path.
The value of this field cannot be changed after a server has been
defined.</p>
</div>
<div class="paragraph">
<p><strong>indexPath</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the path were data created by indexes should be
stored. This parameter is required.<br>
<em>Field rules:</em> The <code>indexPath</code> is required and be set to a valid path.
The value of this field cannot be changed after a server has been
defined.</p>
</div>
<div class="sect3">
<h4 id="the-pod-policy"><a class="anchor" href="#the-pod-policy"></a>The Pod Policy</h4>
<div class="paragraph">
<p>The Pod policy defines settings that apply to all Pods deployed with
this node configuration. A Pod always contains a single running instance
of Couchbase Server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">...
    podPolicy:
      couchabseEnv:
        CB_ENV_VAR: value
      resources:
        limits:
          cpu: 4GHz
          memory: 8GiB
          storage: 100GiB
        requests:
          cpu: 2GHz
          memory: 8GiB
          storage: 50GiB
      labels:
        couchbase_services: all
      nodeSelector:
        instanceType: large
      tolerations:
        key: app
        operator: Equal
        value: cbapp
        effect: NoSchedule</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>couchbaseEnv</strong></p>
</div>
<div class="paragraph">
<p>This field specifies the environment variables (as key-values pairs)
that should be set when the Pod is started. The key in this case is the
environment variable name and the value is the value of the environment
variable. This section is optional.<br>
<em>Field rules:</em> The value of this field cannot be changed after a server
has been defined.</p>
</div>
<div class="sect4">
<h5 id="resources"><a class="anchor" href="#resources"></a>Resources</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">...
    resources:
      limits:
        cpu: 2GHz
        memory: 8GiB
        storage: 100GiB
      requests:
        cpu: 1.5GHz
        memory: 8GiB
        storage: 50GiB
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>limits</strong></p>
</div>
<div class="paragraph">
<p>This field lets you reserve resources on a specific node. It defines the
maximum amount of CPU, memory, and storage the Pods created in this node
specification will reserve.</p>
</div>
<div class="paragraph">
<p><strong>requests</strong></p>
</div>
<div class="paragraph">
<p>This field lets you reserve resources on a specific node. The requests
section defines the minimum amount of CPU, memory, and storage the pods
created in this node specification will reserve.</p>
</div>
<div class="paragraph">
<p>See the Kubernetes documentation for further information about
<a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/">managing
compute resources</a>.</p>
</div>
<div class="paragraph">
<p><strong>labels</strong></p>
</div>
<div class="paragraph">
<p>Labels are key-value pairs that are attached to objects in Kubernetes.
They are intended to specify identifying attributes of objects that are
meaningful to the user and do not directly imply semantics to the core
system. Labels can be used to organize and select subsets of objects.
They do not need to be unique across multiple objects. This section is
optional.</p>
</div>
<div class="paragraph">
<p>Labels added in this section will apply to all pods added in this
cluster. Note that by default we add the following labels to each pod,
which should not be overridden.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>app:couchbase
couchbase_cluster:&lt;metadata:name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the sample configuration file referenced in this topic, the label
would be couchbase_cluster:cb-example</p>
</div>
<div class="paragraph">
<p>The label for the first pod is of the format: couchbase_node: -</p>
</div>
<div class="paragraph">
<p>In the sample configuration file referenced in this topic, the label for
the first pod would be couchbase_node:cb-example-0000</p>
</div>
<div class="paragraph">
<p>See the Kubernetes documentation about
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">labels</a>
for more information.<br>
<em>Field rules:</em> The value of this field cannot be changed after a server
has been defined.</p>
</div>
<div class="paragraph">
<p><strong>nodeSelector</strong></p>
</div>
<div class="paragraph">
<p>This field specifies a key-value map of the constraints on node
placement for pods. For a pod to be eligible to run on a node, the node
must have each of the indicated key-value pairs as labels (it can have
additional labels as well). If this section is not specified, then
Kubernetes will place the pod on any available node. See the Kubernetes
documentation about
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors">label
selectors</a> for more details.<br>
<em>Field rules:</em> The value of this field cannot be changed after a server
has been defined.</p>
</div>
<div class="paragraph">
<p><strong>tolerations</strong></p>
</div>
<div class="paragraph">
<p>This field specifies conditions upon which a node should not be selected
when deploying a pod. From the sample configuration file referenced in
this topic, you can see that any node with a label app:cbapp should not
be allowed to run the pod defined in this node specification. You might
do this if you have nodes dedicated for running an application using
Couchbase where you donât want the database and application to be
running on the same node. See the Kubernetes documentation on
<a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">taints
and tolerations</a> for more information on setting tolerations. The
tolerations section is optional.<br>
<em>Field rules:</em> The value of this field cannot be changed after a server
has been defined.</p>
</div>
</div>
</div>
</div>
</article>
    <script>
      if (window.location.host === 'www.couchbaseinc.acct.us.onehippo.com' || window.location.host === 'developer.couchbase.com') {
        var heading = document.querySelector('div.body h1');
        heading.style.display = 'none';
      }
    </script>
    </div>
  </main>
</div>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>

<!-- Require_js bootstrap for app-specific JS module support -->
<!-- data-main attribute tells require.js to load
scripts/main.js after require.js loads. -->
<script type="text/javascript" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/require.js"></script>
<script type="text/javascript" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/prism.js"></script>
<script rel="main" type="text/javascript" src="https://developer.couchbase.com/webfiles/1498186094252/js/main.js" ></script>
<!-- leave the main attribute, it is used to help main.js determine -->
<!-- the domain-relative path to the base script (main.js) -->  </body>
</html>
