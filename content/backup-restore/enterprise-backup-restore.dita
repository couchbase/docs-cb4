<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_rr5_sv3_t5">
  <title>Enterprise Grade Backup and Restore tool</title><shortdesc>Couchbase Server 4.5 provides a new enterprise-grade Backup and Restore tool that can
    back up larger data sets with much higher performance.</shortdesc>
  <body>
    <section>
      <title>About the Backup and Restore tool</title>
      <p>The Backup and Restore tool is a utility to help manage and store backup and recovery data
        on disk for your Couchbase Server. It backs up and restores bucket data, views creation
        scripts, index creation scripts, bucket configurations, and so on. Backups are stored in an
        Archive Repository that contains each backup.</p>
      <note type="tip">Backup and restore capabilities are critical to an overall Disaster Recovery
        Plan and ensuring business continuity. As part of that plan, it is recommended to define
        what the plan's <xref href="https://en.wikipedia.org/wiki/Recovery_time_objective"
          format="html" scope="external">Recovery Time Objective</xref> (RTO) and <xref
          href="https://en.wikipedia.org/wiki/Recovery_point_objective" format="html"
          scope="external">Recovery Point Objective</xref> (RPO) will be and how the backup and
        restore tool fits into that plan.</note>
      <p>All backup is stored in and recovered from a <term>Backup Respository</term>. In turn, a
          <term>Backup Respository</term> is stored in a Backup Archive on the filesystem. Each
        backup job in the <term>Backup Repository.</term> stores its backup in two ways: <ul
          id="ul_m4b_x5f_z5">
          <li>All bucket data is stored in a secondary smaller database (ForestDB).</li>
          <li>All bucket creation scripts and configuration files are stored on the file system as
            files.</li>
        </ul>
        <note type="important">The Backup and Restore tool is not backward compatible for backups
          made with <cmdname>cbbackup</cmdname>.</note></p>
      <p>The tool is installed with all other tools in the following locations on each platform: </p>
      <p>
        <table frame="all" rowsep="1" colsep="1" id="table_a34_jpf_z5">
          <title>Backup Tool Locations</title>
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="1*"/>
            <colspec colname="c2" colnum="2" colwidth="5*"/>
            <thead>
              <row>
                <entry>Operating system</entry>
                <entry>Directory locations</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Linux</entry>
                <entry><filepath>/opt/couchbase/bin</filepath>
                </entry>
              </row>
              <row>
                <entry>Mac OS X</entry>
                <entry><filepath>/Applications/Couchbase
                    Server.app/Contents/Resources/couchbase-core/bin</filepath>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </p>
    </section>
    <section>
      <title>How the Tool Works</title>
      <p>By default, the Backup and Restore tool performs incremental backups to back up only the
        new data. However, on a new cluster and for the first time this tool will produce a full
        backup. Each of the subsequent incremental backups will take a fraction of the time needed
        as the full backup. </p>
      <note type="note">Only the full Couchbase administrators can use the Backup and Restore tool
        to back up and restore data. </note>
      <draft-comment author="marija">add a link to RBAC later</draft-comment>
    </section>
    <section>
      <title>Archive Repository</title>
      <p>The backup archive is a directory that contains a set of backup repositories as well as
        logs for the backup client. The backup directory should be modified only by the backup
        client, and any modifications that are not done by that client might result in a corruption
        of backup data. </p>
      <p>Only one backup client can access the backup archive at one time. If multiple instances of
        the backup client are running on the same archive at the same time, this might result in
        corruption. To prevent such corruption instances, you may be required to create multiple
        backup archives depending on your use case. </p>
    </section>
    <section>
      <title>Sample Bucket Backup</title>
      <p>Here are the steps to follow to perform a simple, quick backup across all nodes of the
        cluster.</p>
      <p>The examples are to a server on localhost, but they could be to a remote cluster. You must
        provide at one node of the target cluster and the <cmdname>backup</cmdname> command will get
        the cluster map. </p>
      <dl>
        <dlentry>
          <dt>Create an archive repository with the command <cmdname>create</cmdname>:</dt>
          <dd>It is required that each archive has a directory path to store the backups and a name
            to refer to it.</dd>
          <dd>
            <p>On Linux and Mac OS:
              <codeblock>$> ./backup create --name travel --dir /data/couchbase/backups </codeblock></p>
          </dd>
          <dd>This creates a backup directory named <codeph>travel</codeph>. If this directory does
            not exist, the backup tool will attempt to create it. </dd>
        </dlentry>
      </dl>
      <dl>
        <dlentry>
          <dt>Back up the bucket with the command <cmdname>cluster</cmdname>:</dt>
          <dd>
            <p>On Linux and Mac OS:
              <codeblock>$> ./backup cluster --dir /data/couchbase/backups --host couchbase://<varname>localhost</varname> \
--username <varname>MyAdminUsername</varname> --password <varname>MyAdminPassword</varname> --name travel</codeblock></p>
          </dd>
          <dd>The output of these commands will look similar to the following: <p><image
                href="pict/backup-output.png" id="image_hqm_kmb_y5"/>
            </p></dd>
          <dd>The duration and size of your backups will vary depending on the size of your data,
            number of nodes, network congestions, disk speed, cluster activity, among other
            things.</dd>
        </dlentry>
      </dl>
      <dl>
        <dlentry>
          <dt>Restore the bucket data with the command <cmdname>restore</cmdname></dt>
          <dd>Here are the steps to do a restore operation on a cluster.</dd>
          <dd>
            <p>On Linux and Mac OS:
              <codeblock>$> ./backup restore  restore --dir=/data/couchbase/backups --host couchbase://<varname>localhost</varname> \
--username <varname>MyAdminUsername</varname> --password <varname>MyAdminPassword</varname> --name travel</codeblock></p>
          </dd>
        </dlentry>
      </dl>
    </section>
  </body>
</topic>
