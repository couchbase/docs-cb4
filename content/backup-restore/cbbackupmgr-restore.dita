<?xml version="1.0" encoding="UTF-8"?>
<!-- GENERATED BY man2dita. DO NOT EDIT THIS DOCUMENT DIRECTLY. -->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="cbbackupmgr-restore.1">
  <title>cbbackupmgr restore</title>
  <body>
    <section>
      <title>Name</title>
      <p>cbbackupmgr-restore - Restores data from the backup archive to a Couchbase cluster </p>
    </section>
    <section>
      <title>Synopsis</title>
      <p><i>cbbackupmgr restore</i> [--archive &lt;archive_dir&gt;] [--repo &lt;repo_name&gt;] [--start &lt;backup&gt;] [--end &lt;backup&gt;] [--exclude-buckets &lt;bucket_list&gt;] [--include-buckets &lt;bucket_list&gt;] [--disable-bucket-config] [--disable-views] [--disable-gsi-indexes] [--disable-ft-indexes] [--disable-data] [--force-updates][--threads &lt;integer&gt;] [--no-progress-bar] </p>
    </section>
    <section>
      <title>Description</title>
      <p>Restores data from the backup archive to a target Couchbase cluster. </p>
      <p>The restore command is capable of restoring a single backup or a range of backups. When restoring a single backup, all data from that backup is restored. If a range of backups is restored, then <i>cbbackupmgr</i> will take into account any failovers that may have occurred in between the time that the backups were originally taken. If a failover did occur in between the backups, and the backup archive contains data that no longer exists in the cluster, then the data that no longer exists will be skipped during the restore. If no failovers occurred in between backups then restoring a range of backups will restore all data from each backup. If all data must be restored regardless of whether a failover occurred in between the original backups, then data should be restored one backup at a time. </p>
      <p>The restore command is guaranteed to work during rebalances and failovers. If a rebalance is taking place, <i>cbbackupmgr</i> will track the movement of vbuckets around a Couchbase cluster and ensure that data is restored to the appropriate node. If a failover occurs during the restore then the client will wait 180 seconds for the failed node to be removed from the cluster. If the failed node is not removed in 180 seconds then the restore will fail, but if the failed node is removed before the timeout then data will continue to be restored. </p>
    </section>
    <section>
      <title>Options</title>
      <p>Below is a list of required and optional parameters for the restore command. </p>
      <b>Required</b>
      <p>--archive &lt;archive_dir&gt; </p><sl>
        <sli>The directory containing the backup repository to restore data from. 
        </sli></sl>
      <p>--repo &lt;repo_name&gt; </p><sl>
        <sli>The name of the backup repository to restore data from. 
        </sli></sl>
      <p>--host &lt;hostname&gt; </p><sl>
        <sli>The hostname of one of the nodes in the cluster to restore data to. 
See the Host Formats section below for hostname specification details. 
        </sli></sl>
      <p>--username &lt;username&gt; </p><sl>
        <sli>The username for cluster authentication. 
        </sli></sl>
      <p>--password &lt;password&gt; </p><sl>
        <sli>The password for cluster authentication. 
        </sli></sl>
      <b>Optional</b>
      <p>--start &lt;backup&gt; </p><sl>
        <sli>The name of the	first backup in	the backup repository to restore. 
If not specified this value will default to the oldest backup in the backup repository. 
        </sli></sl>
      <p>--end &lt;backup&gt; </p><sl>
        <sli>The name of the last backup in the backup repository to restore. 
If not specified this value will default to the most recent backup in the backup repository. 
        </sli></sl>
      <p>--exclude-buckets &lt;bucket_list&gt; </p><sl>
        <sli>Restores all buckets in a backup that are not specified in &lt;bucket_list&gt;. 
This flag cannot be specified at the same time as the --include-buckets flag. 
Takes a comma separated list of bucket names. 
        </sli></sl>
      <p>--include-buckets &lt;bucket_list&gt; </p><sl>
        <sli>Restores only buckets in a backup that are specified in &lt;bucket-list&gt;. 
This flag cannot be specified at the same time as the --exclude-buckets flag. 
Takes a comma separated list of bucket names. 
        </sli></sl>
      <p>--disable-views </p><sl>
        <sli>Skips restoring view definitions for all buckets. 
        </sli></sl>
      <p>--disable-gsi-indexes </p><sl>
        <sli>Skips restoring gsi index definitions for all buckets. 
        </sli></sl>
      <p>--disable-ft-indexes </p><sl>
        <sli>Skips restoring full-text index definitions for all buckets. 
        </sli></sl>
      <p>--disable-data </p><sl>
        <sli>Skips restoring all key-value data for all buckets. 
        </sli></sl>
      <p>--force-updates </p><sl>
        <sli>Forces data in the Couchbase cluster to be overwritten even if the data in the cluster is newer. 
By default updates are not forced and all updates use Couchbase's conflict resolution mechanism to ensure that if newer data exists on the cluster that is not overwritten by older restore data. 
        </sli></sl>
      <p>--threads &lt;num&gt; </p><sl>
        <sli>Specifies the number of concurrent clients to use when restoring data. 
Fewer clients means restores will take longer, but there will be less cluster resources used to complete the restore. 
More clients means faster restores, but at the cost of more cluster resource usage. 
This parameter defaults to 1 if it is not specified and it is recommended that this parameter is not set to be higher than the number of CPUs on the machine where the restore is taking place. 
        </sli></sl>
      <p>--no-progress-bar </p><sl>
        <sli>By default, a progress bar is printed to stdout so that the user can see how long the restore is expected to take, the amount of data that is being transferred per second, and the amount of data that has been restored. 
Specifying this flag disables the progress bar and is useful when running automated jobs. 
        </sli></sl>
    </section>
    <section>
      <title>Host Formats</title>
      <p>When specifying a host for the <i>restore</i> command the following formats are expected: </p>
      <ul>
        <li>couchbase://&lt;addr&gt; 
        </li>
      </ul>
      <ul>
        <li>&lt;addr&gt;:&lt;port&gt; 
        </li>
      </ul>
      <ul>
        <li>http://&lt;addr&gt;:&lt;port&gt; 
        </li>
      </ul>
      <p>It is recommended to use the couchbase://&lt;addr&gt; format for standard installations. The other two formats allow an option to take a port number which is needed for non-default installations where the admin port has been set up on a port other that 8091. </p>
    </section>
    <section>
      <title>Examples</title>
      <p>The restore command can be used to restore a single backup or range of backups in a backup repository. In the examples below, we will look a few different ways to restore data from a backup repository. All examples will assume that the backup archive is located at /data/backups and that all backups are located in the "example" backup repository. </p>
      <p>The first thing to do when getting ready to restore data is to decide which backups to restore. The easiest way to do this is to use the <i>list</i> command to see which backups are available to restore. </p>
      <codeblock>$ cbbackupmgr list --archive /data/backups --repo example 
 
Size      Items          Name 
2.24GB    -              + example 
1.11GB    -                  + 2016-03-08T14_41_10.757145596-08_00 
1.11GB    -                      + default 
295B      0                          bucket-config.json 
1.11GB    983797                     + data 
1.11GB    983797                         shard_0.fdb 
2B        0                          full-text.json 
128B      0                          gsi.json 
2B        0                          views.json 
430.52MB  -                  + 2016-03-09T14_42_24.024494032-08_00 
430.52MB  -                      + default 
295B      0                          bucket-config.json 
430.52MB  334400                     + data 
430.52MB  334400                         shard_0.fdb 
2B        0                          full-text.json 
128B      0                          gsi.json 
2B        0                          views.json 
728.72MB  -                  + 2016-03-10T14_42_58.743250296-08_00 
728.72MB  -                      + default 
295B      0                          bucket-config.json 
728.72MB  607500                     + data 
728.72MB  607500                         shard_0.fdb 
2B        0                          full-text.json 
128B      0                          gsi.json 
2B        0                          views.json </codeblock>
      <p>From listing the backup repository we can see we have three backups that we can restore in the "examples" backup repository. If we just want to restore one of them we set the --start and --end flags in the restore command to the same backup name and specify the cluster that we want to restore the data to. In the example below we will restore only the oldest backup. </p>
      <codeblock>$ cbbackupmgr restore --archive /data/backups --repo example \ 
--host couchbase://127.0.0.1 --username Administrator --password password \ 
--start 2016-03-08T14_41_10.757145596-08_00 \ 
--end 2016-03-08T14_41_10.757145596-08_00 </codeblock>
      <p>If we want to restore only the two most recent backups then we specify the --start and --end flags with different backup names in order to specify the range we want to restore. </p>
      <codeblock>$ cbbackupmgr restore --archive /data/backups --repo example \ 
--host couchbase://127.0.0.1 --username Administrator --password password \ 
--start 2016-03-09T14_42_24.024494032-08_00 \ 
--end 2016-03-10T14_42_58.743250296-08_00 </codeblock>
      <p>If we want to restore all of the backups in the "examples" directory then we can omit the --start and --end flags since their default values are the oldest and most recent backup in the backup repository. </p>
      <codeblock>$ cbbackupmgr restore --archive /data/backups --repo example \ 
--host couchbase://127.0.0.1 --username Administrator --password password </codeblock>
    </section>
    <section>
      <title>Discussion</title>
      <p>The restore command works by replaying the data recorded into backup files. During the restore this will create key-value traffic against the cluster that will show up in the form of "set" operations. The restore command replays data from each file in order to guarantee that older backup data does not overwrite newer data. The restore command uses Couchbase's conflict resolution mechanism by default to ensure this behavior. The conflict resolution mechanism can be disable by specifying the --force-updates flag when executing a restore. </p>
      <p>Unlike backups, restores cannot be resumed if they fail. </p>
    </section>
    <section>
      <title>Environment And Configuration Variables</title>
      <p>(None) </p>
    </section>
    <section>
      <title>See Also</title>
      <p><xref href="cbbackupmgr-backup.dita"/>, <xref href="cbbackupmgr-list.dita"/> </p>
    </section>
    <section>
      <title>Cbbackupmgr</title>
      <p>Part of the <xref href="cbbackupmgr.dita"/> suite  </p>
    </section>
  </body>
</topic>